<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Escudo do Jogador — RPG</title>

<style>
/* =========================
   TEMAS (CSS VARIABLES)
========================= */
:root{--bg:#1c1c1c;--panel:#2a2a2a;--border:#8b6f3d;--text:#e8e6e3;--accent:#c2a96b;--input:#1f1f1f}
[data-theme="light"]{--bg:#f4f1ec;--panel:#ffffff;--border:#8b6f3d;--text:#1c1c1c;--accent:#6b4f1d;--input:#f0ece6}
[data-theme="grim"]{--bg:#0f0f12;--panel:#19191f;--border:#7a1e1e;--text:#e2e2e2;--accent:#b03a3a;--input:#141418}
[data-theme="minimal"]{--bg:#ffffff;--panel:#f7f7f7;--border:#cccccc;--text:#111111;--accent:#555555;--input:#ffffff}
*{box-sizing:border-box;margin:0;padding:0;font-family:Georgia,serif}
body{background:var(--bg);color:var(--text);padding:20px}
h1,h2,h3{font-family:Cinzel,serif;letter-spacing:1px}
.shield{display:grid;grid-template-columns:1fr;gap:16px;max-width:1400px;margin:auto}
.grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.panel{background:var(--panel);border:2px solid var(--border);border-radius:8px}
.panel-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;cursor:pointer}
.panel-header h2{color:var(--accent);font-size:1.1rem}
.panel-content{padding:14px}
.panel.collapsed .panel-content{display:none}
.panel.collapsed .toggle::after{content:"▸"}
.toggle::after{content:"▾"}
input,textarea,select{width:100%;background:var(--input);border:1px solid var(--border);color:var(--text);padding:6px;border-radius:4px;margin-top:6px}
textarea{resize:vertical;min-height:100px}
button{margin-top:6px;padding:6px;width:100%;background:var(--border);border:none;border-radius:4px;font-weight:bold;color:#000;cursor:pointer}
.counter{display:flex;gap:6px;align-items:center}
.counter span{flex:1;text-align:center;font-weight:bold}
.attr{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.attr div{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px}
header.sticky{position:sticky;top:0;z-index:10;background:var(--bg);padding-bottom:10px}
</style>
</head>

<body data-theme="dark">
<header class="sticky"><h1>Escudo do Jogador — RPG</h1></header>

<main class="shield">

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>Configurações</h2><span class="toggle"></span></div><div class="panel-content">
<select id="tema" onchange="mudarTema()">
<option value="dark">Clássico Dark</option>
<option value="light">Pergaminho Claro</option>
<option value="grim">Grim / Dark Fantasy</option>
<option value="minimal">Minimalista</option>
</select>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<div class="grid-2" style="align-items:flex-start">

<!-- Foto do personagem -->
<div style="max-width:220px">
<label>Retrato</label>
<input type="file" accept="image/*" onchange="carregarImagem(event)" />
<div class="image-preview">
<img id="img" style="aspect-ratio:1/1;object-fit:cover"/>
</div>
</div>

<!-- Dados principais -->
<div>
<label>Nome</label><input id="nome" />
<label>Classe (D&D 5e ou Personalizada)</label>
<select id="classeSelect" onchange="sincronizarClasse()">
<option value="">— Selecionar Classe —</option>
<option>Barbarian</option><option>Bard</option><option>Cleric</option><option>Druid</option><option>Fighter</option><option>Monk</option><option>Paladin</option><option>Ranger</option><option>Rogue</option><option>Sorcerer</option><option>Warlock</option><option>Wizard</option>
<option value="custom">Classe Personalizada</option>
</select>
<input id="classe" placeholder="Nome da classe personalizada" />

<label>Antecedente</label><input id="background" />
<label>Nível</label><input type="number" id="nivel" value="1" />

<div class="grid-2" style="margin-top:6px">
<div>
<label>Defesa (CA)</label><input type="number" id="ca" />
<label>Iniciativa</label><input type="number" id="init" />
</div>
<div>
<label>Pontos de Vida</label>
<div class="counter"><button onclick="modPV(-1)">-</button><span id="pvAtual">0</span><button onclick="modPV(1)">+</button></div>
<label>PV Máximo</label><input type="number" id="pvMax" onchange="syncPV()" />
</div>
</div>
</div>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<div class="attr" id="atributos">
<div><input placeholder="Nome" value="FOR"/><input type="number" value="10"/></div>
<div><input placeholder="Nome" value="DES"/><input type="number" value="10"/></div>
<div><input placeholder="Nome" value="CON"/><input type="number" value="10"/></div>
<div><input placeholder="Nome" value="INT"/><input type="number" value="10"/></div>
<div><input placeholder="Nome" value="SAB"/><input type="number" value="10"/></div>
<div><input placeholder="Nome" value="CAR"/><input type="number" value="10"/></div>
</div>
<p style="margin-top:6px;font-size:.8rem;opacity:.7">Edite nomes e valores conforme o sistema.</p>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<div class="grid-2">
<div>
<h3>Condições</h3>
<div class="conditions">
<label><input type="checkbox"/> Afetado</label>
<label><input type="checkbox"/> Debilitado</label>
<label><input type="checkbox"/> Atordoado</label>
</div>
</div>
<div>
<h3>Dice Roller</h3>
<select id="dice"><option>d4</option><option>d6</option><option>d8</option><option>d10</option><option>d12</option><option selected>d20</option><option>d100</option></select>
<input id="qtd" type="number" value="1" />
<input id="mod" type="number" value="0" />
<button onclick="rolar()">Rolar</button>
<div id="resultado"></div>
</div>
</div>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<textarea id="itens"></textarea>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<label>Nível Máximo</label>
<input type="number" id="nivelMagia" value="1" onchange="listarMagias()" />
<div id="listaMagias"></div>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<textarea id="notas"></textarea>
</div></section>

<section class="panel"><div class="panel-header" onclick="togglePanel(this)"><h2>$1</h2><span class="toggle"></span></div><div class="panel-content">
<button onclick="salvar()">Salvar Local</button>
<button onclick="exportar()">Exportar Save</button>
<input type="file" accept="application/json" onchange="importar(event)" />
</div></section>

</main>

<script>
function togglePanel(h){h.parentElement.classList.toggle('collapsed')}
// --- SRD simplificado (exemplo funcional)
const SRD_SPELLS=[
{name:'Cura pelas Mãos',level:1,classes:['Clérigo','Paladino']},
{name:'Mísseis Mágicos',level:1,classes:['Mago','Feiticeiro']},
{name:'Bola de Fogo',level:3,classes:['Mago','Feiticeiro']},
{name:'Relâmpago',level:3,classes:['Mago']},
{name:'Reviver',level:5,classes:['Clérigo','Bardo']}
];

let pv=0;
function modPV(v){pv+=v;if(pv<0)pv=0;pvAtual.innerText=pv}
function syncPV(){pv=parseInt(pvMax.value)||0;modPV(0)}

function listarMagias(){
 const cont=document.getElementById('listaMagias');
 cont.innerHTML='';
 const classeAtual=classe.value;
 const nivelMax=parseInt(nivelMagia.value)||0;
 const filtradas=SRD_SPELLS.filter(s=>s.level<=nivelMax && (!classeAtual || s.classes.includes(classeAtual)));
 filtradas.forEach(s=>{
  const d=document.createElement('div');
  d.className='spell';
  d.innerHTML=`<strong>${s.name}</strong> <small>Nível ${s.level}</small>`;
  cont.appendChild(d);
 });
 if(!filtradas.length) cont.innerHTML='<em>Nenhuma magia disponível</em>';
}

function rolar(){const d=parseInt(dice.value.replace('d',''));const q=parseInt(qtd.value);const m=parseInt(mod.value);let t=0,r=[];for(let i=0;i<q;i++){let x=Math.floor(Math.random()*d)+1;r.push(x);t+=x;}t+=m;resultado.innerText=`${r.join(', ')} = ${t}`}
function carregarImagem(e){const r=new FileReader();r.onload=()=>img.src=r.result;r.readAsDataURL(e.target.files[0])}
function mudarTema(){document.body.setAttribute('data-theme',tema.value);localStorage.setItem('tema',tema.value)}

function salvar(){
 const attrs=[...document.querySelectorAll('#atributos div')].map(d=>({nome:d.children[0].value,valor:d.children[1].value}));
 const s={nome:nome.value,classe:classe.value,background:background.value,nivel:nivel.value,ca:ca.value,init:init.value,pv,pvMax:pvMax.value,attrs,notas:notas.value,itens:itens.value,img:img.src,tema:tema.value,nivelMagia:nivelMagia.value};
 localStorage.setItem('rpgShieldSave',JSON.stringify(s));alert('Salvo')}

function carregar(s){
 nome.value=s.nome||'';classe.value=s.classe||'';background.value=s.background||'';nivel.value=s.nivel||1;ca.value=s.ca||'';init.value=s.init||'';pv=s.pv||0;pvMax.value=s.pvMax||0;modPV(0);
 notas.value=s.notas||'';itens.value=s.itens||'';nivelMagia.value=s.nivelMagia||1;
 if(s.attrs){const a=document.querySelectorAll('#atributos div');s.attrs.forEach((v,i)=>{if(a[i]){a[i].children[0].value=v.nome;a[i].children[1].value=v.valor}})}
 if(s.img)img.src=s.img;if(s.tema){tema.value=s.tema;mudarTema()}listarMagias()}

function exportar(){const b=new Blob([localStorage.getItem('rpgShieldSave')],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='rpg_shield_save.json';a.click()}
function importar(e){const r=new FileReader();r.onload=()=>{localStorage.setItem('rpgShieldSave',r.result);carregar(JSON.parse(r.result))};r.readAsText(e.target.files[0])}
window.onload=()=>{const s=localStorage.getItem('rpgShieldSave');if(s)carregar(JSON.parse(s));const t=localStorage.getItem('tema');if(t){tema.value=t;mudarTema()}listarMagias()}
</script>
</body>
</html>
